# script

m: xxx
r: yyy

https://www.youtube.com/watch?v=PPZ5XiTr_lI  
パステルハウス

#### 1

m 
みなさんこんにちは  
本日はプログラムの説明をしていこうと思います　

#### 2

m 今回のスライドでは、こちらのリポジトリの内容を説明します。  
r 最近流行りのgithubにソースコードがあるのですね。  
m 概要欄にリポジトリへのリンクを貼っておきますのでご参考ください。  

#### 3

m こちらが目次となります。  
m まずプログラムの概要を説明した後、  
m ルールやプログラムの全体像、サンプルプログラムについて説明します。  
r 環境構築についても触れようと思いますので、  
r プログラムを動かすイメージに少しでも繋がれば嬉しいです。  

#### 4

m 本プログラムの概要です。  
m 本プログラムは、プログラミング教育でおなじみのテトリス風のゲームを題材にしています。  

r: 昔ファミコンとかで遊んだことがある人も多い気がします。  
　　ご存知の通りブロックを動かして得点を競うパズルゲームですね。    

m ゲーム自体はプログラミング言語であるPythonを使って用意しました。  
m ブロックを動かす部分をカスタマイズして独自のアルゴリズムを作り込めるような構造にしています。  

#### 5

m 実際に動かしている様子がこちらです  
r あれ、動いてませんね  
m 動作上で動画を動かせなかったのですが、雰囲気伝わると思います  
  
m 同じブロックが落ちてきてもアルゴリズムによって置き方が異なるため、  
m それが盤面の違いに表れています。  
r AIに関しても学習のさせかたによって性能が変わるので、それが置き方に違いに繋がっています      
m プログラムやアルゴリズムを理解する事はもちろんですが、  
m どうすればつよいアルゴリズムを作れるのかも興味深いですね。    

#### 6

m ゲームのルールです  
m 一般的なやり方同様、一定の大きさのフィールドにブロックを定期的に置いていき、獲得スコアを競います。  
m 一列以上揃ったら消した列の数に応じた得点を獲得し、180秒以内の獲得スコアを競います  
m ブロックが上部まで詰まったらフィールドがリセットされ、スコアが減点されます。  
r とにかく4列消しをしていけばいいっぽい感じですかね  
m いくつか難易度があり、難易度が高いほど4列消しがやりづらくなっています、次ページで説明します  


#### 7

m ゲームの難易度設定についてです  
m ゲームの難易度は４段階あり、レベル１が易しくて、レベルが上がるほど難易度が高いです。  
m 難易度はプログラムの実行時にオプションで指定できるようにしています。  
r レベルが変わると具体的に何が変わるのでしょうか  
m レベルが変わると、ブロックが出現する順番、フィールドの初期ブロック、フレーム更新頻度が変わります  
m 次のページから詳細を述べていきます。  

#### 8

m まずレベル1についてです  
m レベル1はブロックが出現する順番が固定である事が特徴です  
m フィールドの初期ブロックは存在せず、ブロックが登場する頻度も一定であり、最もシンプルな難易度設定になっています  
r まずはここから考えるとステップアップできそうですね  

#### 9

m level1のブロックの順番固定についてです  
m ブロックは記載の通り7種類あり、それぞれインデックスが付いています  
m レベル1では、インデックスが1から7のものが順番に繰り返し落ちてきます  
r 順番固定であれば、プログラムもある程度固定の実装でもスコア狙えるかもしれませんね  

#### 10

次にレベル2についてです  
m レベル2は、レベル1と異なりブロックが出現する順番がランダムである事が特徴です  
r 他の条件は同じですが、プログラムの柔軟性がより求められる感じですね  
r ファミコンとかで遊んでたルールに近いと思うので、いつも頭の中で考えていたことを実装してみるといいかもしれませんね

#### 11

レベル3についてです
m レベル3は、ブロックが出現する順番がランダムである事に加えて、
m フィールドにブロックがあることに加えてが特徴です  
r なんか邪魔そうなものが置いてありますね
m 最初から10段分のお邪魔ブロックがあり、ちょっと難易度が高くなっています  
r 全部消したら全消しボーナス加点があると聞いたので、何か工夫したいですね

#### 12

そして、レベル4についてです  
m レベル4、レベル3の条件に加えてブロックが落ちるスピードがとてもはやい！ことが特徴です  
r どれくらい速いのかな  
m ものすごく速いです、１ミリ秒くらいなので目にも留まらぬ速さです  
r 処理高速化や処理ボトルネック解析など、つよめのノウハウが要りそう感がありますね    

#### 13

m その他にも、AI部門として、  
m 強化学習などを利用したプログラム同士で戦う部門や  
m 芸術部門として、  
m ブロックでartを作成して芸術性を競うにぎやかし部門など、自由度高めに色々やっていきたいと思います    
m サンプルコードも用意しているので興味ありましたらリポジトリの説明読んでみてください  
r どこかの展示会に出展できそう感がありますね   

#### 14

m 続きまして、ここからはプログラムの全体構成について説明します  
m 全体構成として、  
m ゲーム管理用プログラム、ボード管理用プログラム、ブロック操作用プログラム、ゲーム開始用コマンドの、  
m 大きく４種類のファイルがあります  
r 今回はブロックを動かす部分をカスタマイズするので、ブロック操作用プログラムをいじっていく感じですね
m はい、基本的にはブロック操作用プログラムをいじっていく感じでOKです
m プログラムをいじるための補足情報と合わせて詳細を述べていきますー

#### 15

m ブロック操作用プログラムとボード情報についてです  
m ブロック操作用プログラムは、その名の通り、ブロックの次の動作を決定するプログラムです  
m ブロックの次の動作を決定するには、ボードの情報を見る必要があるので、そちらの構造も説明します
r なんか物々しい感じですが、とりあえずゲームでやってることをイメージしてみます
m ボードの情報は、ブロックを置いているフィールドの情報、次のブロックの情報、審判情報などが含まれます
m フィールドの情報、ブロックの情報を補足していきます  

#### 16

m フィールド情報についてです  
m フィールドは横10×縦22の大きさの二次元座標です、
m プログラム的には配列で表現しています、
m 例えば、座標xyにアクセスするためには、配列の所定のデータにアクセスします  
r なんかプログラミングの配列の知識とかいりそうですね   

#### 17

m フィールドに格納されているデータについてです  
m フィールドの各座標には、ブロックが置いてあるかどうかの情報が格納されています  
m ブロックが何も置かれていない場合は、0の値が入っています  
m ブロックが置いてある場合は、0以外の値が入っています、  
r ブロックの置く場所を考えるときに、この配列の値に応じて条件分岐すればよさそう感がありますね、 
r また、盤面のでこぼこ度合いを数値化したい場合とかも、このへんを見れば良さそう感がありますね  

#### 18

m ブロック情報についてです  
m ブロックは全部で７種類あります、インデックスと書記形状は記載の通り定義しています  
m I字型のブロックは1、L字型のブロックは2、J字型のブロックは3、T字型のブロックは4、O字型のブロックは5、S字型のブロックは6、Z字型のブロックは7です。  
m ブロックは時計回りに回転可能であり、１周に必要な回転数はブロックによって異なります。  

#### 19

m ブロック操作の基準点についてです  
m 各ブロックが回転する場合、回転の基準となる中心座標が存在します  
m 各ブロックのそれぞれの座標を表に記載しています  
r ブロックを回転させる際はこの座標をイメージしておくと良いかもしれませんね  


#### 20

m ブロック出現時の初期位置についてです  
m ブロックが出現する際、その基準点にブロックが既にあればゲームオーバーになります   
r ブロックが上部に詰まってゲームオーバにならないようにするには、　　
r ここの座標を避けるように積んでいくのがよさげな感じですね  

#### 21

m 以上が、フィールド情報でした、  
m フィールド情報を見て、現在のブロックを動かすためには、
m 横軸のどの位置に移動させるか、現在のブロックを何回回転させるか、下にどらくらい落下させるか、
m を少なくとも決定する必要があります。  
r これらをブロック操作用プログラムの出力にする感じですね、  

#### 22

m また、本ゲームではホールド機能が使えます。  
m ホールドはブロックを１個保持できる機能です。  
m 既にブロックをホールドしている場合は、現在のブロックと交換する  
r どのブロックをホールドしておくかはプログラムの個性に繋がりそうです  

#### 23

m 以上がプログラムの全体構成についてでした、  
m ここからは事前に用意しているサンプルプログラムのソースコードについて説明します  
m コード理解の補助になれば嬉しいです  
m また、サンプルコードもgithubに公開しているのでチェックして見てください  

#### 24

m サンプルプログラムは大きく４つ用意しています。  
m １つ目は、動作が完全にランダムなもの  
m ２つ目は、簡易的に探索処理を実装してみたもの  
m ３つ目は、機械学習をつかったもの  
m ４つ目は、アート用のもの、です  
m 次のページから順番に説明します  

#### 25

まずは動作が完全にランダムなもの
これは、ブロックをランダムに置くだけの最もシンプルなプログラムです  

random
ブロックをランダムに置くだけのサンプルプログラム　コード
以下を完全にランダムに置く
x座標
回転回数

組み合わせ
x座標：最大10通り
回転回数：最大4通り
→10×4=40通りから1つ選ぶ
（重複あり、ブロックにより違いあり）

#### 26

簡易的に探索処理を実装してみたもの(python start.py -m sampleで動くもの)　
コード
一般的な探索アルゴリズムでも基本となる
　　以下を簡潔に実装している
1.探索
2.評価

#### 27

探索
現在のブロックの情報（以下）を使って全探索している
現在のブロックが回転できる回数
現在のブロックが移動できるx軸方向の移動量

#### 28

評価
以下を考えた盤面評価を行なっている。
仮に現在のブロックを探索候補箇所に置いた時、消せるブロックが多いほど良い
同様に、穴ぼこや孤立したブロックが少ないほど良い
同様に、高さにばらつきが少ないほど良い

#### 29

現状
例）盤面に穴が残ることがかなり多い
　　なぜ？
課題
数手先読み探索
サンプルプログラムでは探索時に現在のブロックしか考慮できていない
次のブロック以降を考慮する方が良いはず
盤面評価の改良
サンプルプログラムでは目先の１ブロックを消す事を優先している。
サンプルプログラムの手法では盤面に穴が残ることがまだまだ多い。
最適解を人が考える必要がある
AIのように自ら学習する方が楽に最適解を得られる可能性がある。

#### 30

機械学習
深層強化学習という方法を使っています
こちらを参照
解説記事も載っているのでご参照ください、  
つよいAIのノウハウは共有して皆でつよくなっていけるといいですね  

#### 31

参考：環境構築

#### 32

プログラムの説明は以上です、
ご視聴ありがとうございました！


